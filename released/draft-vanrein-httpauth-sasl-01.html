<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>HTTP Authentication with SASL</title>

  <style type="text/css" title="Xml2Rfc (sans serif)">
  /*<![CDATA[*/
	  a {
	  text-decoration: none;
	  }
      /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
      a.info {
          /* This is the key. */
          position: relative;
          z-index: 24;
          text-decoration: none;
      }
      a.info:hover {
          z-index: 25;
          color: #FFF; background-color: #900;
      }
      a.info span { display: none; }
      a.info:hover span.info {
          /* The span will display just on :hover state. */
          display: block;
          position: absolute;
          font-size: smaller;
          top: 2em; left: -5em; width: 15em;
          padding: 2px; border: 1px solid #333;
          color: #900; background-color: #EEE;
          text-align: left;
      }
	  a.smpl {
	  color: black;
	  }
	  a:hover {
	  text-decoration: underline;
	  }
	  a:active {
	  text-decoration: underline;
	  }
	  address {
	  margin-top: 1em;
	  margin-left: 2em;
	  font-style: normal;
	  }
	  body {
	  color: black;
	  font-family: verdana, helvetica, arial, sans-serif;
	  font-size: 10pt;
	  max-width: 55em;
	  
	  }
	  cite {
	  font-style: normal;
	  }
	  dd {
	  margin-right: 2em;
	  }
	  dl {
	  margin-left: 2em;
	  }
	
	  ul.empty {
	  list-style-type: none;
	  }
	  ul.empty li {
	  margin-top: .5em;
	  }
	  dl p {
	  margin-left: 0em;
	  }
	  dt {
	  margin-top: .5em;
	  }
	  h1 {
	  font-size: 14pt;
	  line-height: 21pt;
	  page-break-after: avoid;
	  }
	  h1.np {
	  page-break-before: always;
	  }
	  h1 a {
	  color: #333333;
	  }
	  h2 {
	  font-size: 12pt;
	  line-height: 15pt;
	  page-break-after: avoid;
	  }
	  h3, h4, h5, h6 {
	  font-size: 10pt;
	  page-break-after: avoid;
	  }
	  h2 a, h3 a, h4 a, h5 a, h6 a {
	  color: black;
	  }
	  img {
	  margin-left: 3em;
	  }
	  li {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol p {
	  margin-left: 0em;
	  }
	  p {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  pre {
	  margin-left: 3em;
	  background-color: lightyellow;
	  padding: .25em;
	  }
	  pre.text2 {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f0f0f0;
	  width: 69em;
	  }
	  pre.inline {
	  background-color: white;
	  padding: 0em;
	  }
	  pre.text {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  width: 69em;
	  }
	  pre.drawing {
	  border-style: solid;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  padding: 2em;
	  }
	  table {
	  margin-left: 2em;
	  }
	  table.tt {
	  vertical-align: top;
	  }
	  table.full {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.headers {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.tt td {
	  vertical-align: top;
	  }
	  table.full td {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.tt th {
	  vertical-align: top;
	  }
	  table.full th {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.headers th {
	  border-style: none none inset none;
	  border-width: 1px;
	  }
	  table.left {
	  margin-right: auto;
	  }
	  table.right {
	  margin-left: auto;
	  }
	  table.center {
	  margin-left: auto;
	  margin-right: auto;
	  }
	  caption {
	  caption-side: bottom;
	  font-weight: bold;
	  font-size: 9pt;
	  margin-top: .5em;
	  }
	
	  table.header {
	  border-spacing: 1px;
	  width: 95%;
	  font-size: 10pt;
	  color: white;
	  }
	  td.top {
	  vertical-align: top;
	  }
	  td.topnowrap {
	  vertical-align: top;
	  white-space: nowrap; 
	  }
	  table.header td {
	  background-color: gray;
	  width: 50%;
	  }
	  table.header a {
	  color: white;
	  }
	  td.reference {
	  vertical-align: top;
	  white-space: nowrap;
	  padding-right: 1em;
	  }
	  thead {
	  display:table-header-group;
	  }
	  ul.toc, ul.toc ul {
	  list-style: none;
	  margin-left: 1.5em;
	  margin-right: 0em;
	  padding-left: 0em;
	  }
	  ul.toc li {
	  line-height: 150%;
	  font-weight: bold;
	  font-size: 10pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  ul.toc li li {
	  line-height: normal;
	  font-weight: normal;
	  font-size: 9pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  li.excluded {
	  font-size: 0pt;
	  }
	  ul p {
	  margin-left: 0em;
	  }
	
	  .comment {
	  background-color: yellow;
	  }
	  .center {
	  text-align: center;
	  }
	  .error {
	  color: red;
	  font-style: italic;
	  font-weight: bold;
	  }
	  .figure {
	  font-weight: bold;
	  text-align: center;
	  font-size: 9pt;
	  }
	  .filename {
	  color: #333333;
	  font-weight: bold;
	  font-size: 12pt;
	  line-height: 21pt;
	  text-align: center;
	  }
	  .fn {
	  font-weight: bold;
	  }
	  .hidden {
	  display: none;
	  }
	  .left {
	  text-align: left;
	  }
	  .right {
	  text-align: right;
	  }
	  .title {
	  color: #990000;
	  font-size: 18pt;
	  line-height: 18pt;
	  font-weight: bold;
	  text-align: center;
	  margin-top: 36pt;
	  }
	  .vcardline {
	  display: block;
	  }
	  .warning {
	  font-size: 14pt;
	  background-color: yellow;
	  }
	
	
	  @media print {
	  .noprint {
		display: none;
	  }
	
	  a {
		color: black;
		text-decoration: none;
	  }
	
	  table.header {
		width: 90%;
	  }
	
	  td.header {
		width: 50%;
		color: black;
		background-color: white;
		vertical-align: top;
		font-size: 12pt;
	  }
	
	  ul.toc a::after {
		content: leader('.') target-counter(attr(href), page);
	  }
	
	  ul.ind li li a {
		content: target-counter(attr(href), page);
	  }
	
	  .print2col {
		column-count: 2;
		-moz-column-count: 2;
		column-fill: auto;
	  }
	  }
	
	  @page {
	  @top-left {
		   content: "Internet-Draft"; 
	  } 
	  @top-right {
		   content: "December 2010"; 
	  } 
	  @top-center {
		   content: "Abbreviated Title";
	  } 
	  @bottom-left {
		   content: "Doe"; 
	  } 
	  @bottom-center {
		   content: "Expires June 2011"; 
	  } 
	  @bottom-right {
		   content: "[Page " counter(page) "]"; 
	  } 
	  }
	
	  @page:first { 
		@top-left {
		  content: normal;
		}
		@top-right {
		  content: normal;
		}
		@top-center {
		  content: normal;
		}
	  }
  /*]]>*/
  </style>

  <link href="#rfc.toc" rel="Contents"/>
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction"/>
<link href="#rfc.section.2" rel="Chapter" title="2 Embedding SASL in HTTP"/>
<link href="#rfc.section.2.1" rel="Chapter" title="2.1 HTTP Request and Response Messages"/>
<link href="#rfc.section.2.2" rel="Chapter" title="2.2 Authentication Field Definitions"/>
<link href="#rfc.section.3" rel="Chapter" title="3 Support for Realm Crossover"/>
<link href="#rfc.section.3.1" rel="Chapter" title="3.1 Encrypting SASL for Realm Crossover"/>
<link href="#rfc.section.3.2" rel="Chapter" title="3.2 Viewing Users on HTTP Services"/>
<link href="#rfc.section.4" rel="Chapter" title="4 Security Considerations"/>
<link href="#rfc.section.5" rel="Chapter" title="5 IANA Considerations"/>
<link href="#rfc.references" rel="Chapter" title="6 References"/>
<link href="#rfc.references.1" rel="Chapter" title="6.1 Normative References"/>
<link href="#rfc.references.2" rel="Chapter" title="6.2 Informative References"/>
<link href="#rfc.appendix.A" rel="Chapter" title="A HTTP Server Environment Variables"/>
<link href="#rfc.appendix.B" rel="Chapter" title="B Acknowledgements"/>
<link href="#rfc.authors" rel="Chapter"/>


  <meta name="generator" content="xml2rfc version 2.5.1 - http://tools.ietf.org/tools/xml2rfc" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />

  <meta name="dct.creator" content="Van Rein, R." />
  <meta name="dct.identifier" content="urn:ietf:id:draft-vanrein-httpauth-sasl-01" />
  <meta name="dct.issued" scheme="ISO8601" content="2018-11-8" />
  <meta name="dct.abstract" content="Most application-level protocols standardise their authentication exchanges under the SASL framework.  HTTP has taken another course, and often ends up replicating the work to allow individual mechanisms.  This specification adopts full SASL authentication into HTTP." />
  <meta name="description" content="Most application-level protocols standardise their authentication exchanges under the SASL framework.  HTTP has taken another course, and often ends up replicating the work to allow individual mechanisms.  This specification adopts full SASL authentication into HTTP." />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
  <td class="left">Network Working Group</td>
  <td class="right">R. Van Rein</td>
</tr>
<tr>
  <td class="left">Internet-Draft</td>
  <td class="right">ARPA2.net</td>
</tr>
<tr>
  <td class="left">Intended status: Standards Track</td>
  <td class="right">November 8, 2018</td>
</tr>
<tr>
  <td class="left">Expires: May 12, 2019</td>
  <td class="right"></td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">HTTP Authentication with SASL<br />
  <span class="filename">draft-vanrein-httpauth-sasl-01</span></p>
  
  <h1 id="rfc.abstract">
  <a href="#rfc.abstract">Abstract</a>
</h1>
<p>Most application-level protocols standardise their authentication exchanges under the SASL framework.  HTTP has taken another course, and often ends up replicating the work to allow individual mechanisms.  This specification adopts full SASL authentication into HTTP.</p>
<h1 id="rfc.status">
  <a href="#rfc.status">Status of This Memo</a>
</h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet-Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on May 12, 2019.</p>
<h1 id="rfc.copyrightnotice">
  <a href="#rfc.copyrightnotice">Copyright Notice</a>
</h1>
<p>Copyright (c) 2018 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (http://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.  Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction</a></li>
<li>2.   <a href="#rfc.section.2">Embedding SASL in HTTP</a></li>
<ul><li>2.1.   <a href="#rfc.section.2.1">HTTP Request and Response Messages</a></li>
<li>2.2.   <a href="#rfc.section.2.2">Authentication Field Definitions</a></li>
</ul><li>3.   <a href="#rfc.section.3">Support for Realm Crossover</a></li>
<ul><li>3.1.   <a href="#rfc.section.3.1">Encrypting SASL for Realm Crossover</a></li>
<li>3.2.   <a href="#rfc.section.3.2">Viewing Users on HTTP Services</a></li>
</ul><li>4.   <a href="#rfc.section.4">Security Considerations</a></li>
<li>5.   <a href="#rfc.section.5">IANA Considerations</a></li>
<li>6.   <a href="#rfc.references">References</a></li>
<ul><li>6.1.   <a href="#rfc.references.1">Normative References</a></li>
<li>6.2.   <a href="#rfc.references.2">Informative References</a></li>
</ul><li>Appendix A.   <a href="#rfc.appendix.A">HTTP Server Environment Variables</a></li>
<li>Appendix B.   <a href="#rfc.appendix.B">Acknowledgements</a></li>
<li><a href="#rfc.authors">Author's Address</a></li>


  </ul>

  <h1 id="rfc.section.1"><a href="#rfc.section.1">1.</a> <a href="#intro" id="intro">Introduction</a></h1>
<p id="rfc.section.1.p.1">HTTP has historically followed its own path for client authentication, while many other end-user protocols standardised on SASL; examples of SASL protocols include SMTP, IMAP, POP, XMPP, LDAP and AMQP.  This specification introduces SASL to HTTP, so it may share in past and future work done for SASL in general.</p>
<p id="rfc.section.1.p.2">Among the work that could be shared is backend authentication integration, which is possible due to protocol-independent SASL exchanges for any given method, making it easy to take them out of one protocol and inserting them into another.  Although HTTP has adopted several SASL-compatible authentication methods, it has uses various notations and so it still needs method-specific support at the HTTP level to translate them to a SASL backend.</p>
<p id="rfc.section.1.p.3">In front-ends, a similar situation has arisen.  The varying syntaxes for authentication methods have made it difficult to rely on support in most or all HTTP clients.  When such clients could externalise their SASL handling to generic software such as a SASL library, then any extension to a library automatically spills over into the HTTP sphere.  It is common for developers of web clients to also produce email clients, so a shared code base (and credential store) is not difficult to imagine.</p>
<p id="rfc.section.1.p.4">Sharing is beneficial in both directions.  HTTP benefits by being able to use GS2 mechanisms <a href="#RFC5801">[RFC5801]</a> with channel binding <a href="#RFC5554">[RFC5554]</a> to TLS <a href="#RFC5929">[RFC5929]</a> based on pinning either the certificate for the TLS server or even a unique part of the individual TLS connection; for instance Kerberos5 <a href="#RFC4120">[RFC4120]</a> currently uses Negotiate authentication <a href="#RFC4559">[RFC4559]</a> which is not as secure as GS2-KRB5-PLUS over SASL.</p>
<p id="rfc.section.1.p.5">SASL also benefits; had it been the norm for HTTP, then the work to pass SAML over it <a href="#RFC6595">[RFC6595]</a> would probably have been done immediately.  In fact, HTTP can still benefit from receiving standardised SAML20 inquiries over SASL, becuase it resolves the need for configuration of initiation paths and practices.  Also, it removes authentication data from URIs, where they are not ideally placed.</p>
<p id="rfc.section.1.p.6">TODO: Does this do justice to current SAML over HTTP?</p>
<p id="rfc.section.1.p.7">In terms of security for HTTP applications, it appears beneficial to have very good authentication capabilities in the layers below the application; this is specifically true for applications developed in HTML and JavaScript, which tend to load code from various places, including code that is not always in the end user's interest; since it already is a concern what identity information passes through these applications, it is certainly not advisable to use credentials in those places.  Browsers are in a better position to take control over these assets, at the protocol levels of HTTP and TLS, and conceal credentials and possibly also identity from applications running on top.  Inasfar as tokens are needed, they can be derived from session keys using generally accepted key derivation schemes, but the session keys can be isolated from dynamic layers above HTTP.</p>
<h1 id="rfc.section.2"><a href="#rfc.section.2">2.</a> <a href="#spec" id="spec">Embedding SASL in HTTP</a></h1>
<p id="rfc.section.2.p.1">This specification integrates the SASL framework <a href="#RFC4422">[RFC4422]</a> into mainstream HTTP <a href="#RFC2616">[RFC2616]</a>.  The SASL Authentication scheme follows the general structure for HTTP Authentication <a href="#RFC7235">[RFC7235]</a>.  It uses the WWW-Authenticate and Proxy-Authenticate headers in responses from web servers and web proxies, respectively, and correspondingly the Authorization and Proxy-Authorization request header to answer to requests.</p>
<p id="rfc.section.2.p.2">The SASL service name for the following embedding of SASL is HTTP; contrary to most other service names, it is spelled in uppercase, in line with what has become general practice in Kerberos and GSSAPI.</p>
<p id="rfc.section.2.p.3">Since SASL prescribes channel binding to occur relative to TLS instead of to the application protocol, we can add that when the HTTPS transport is used.    Whether channel binding is used SHOULD remain a configuration choice in HTTP software, as it might interfere with intentional HTTPS proxying.  Unintended proxying on the other hand, might lead to tapping of credentials under certain SASL mechanisms, and it may be considered helpful to prevent such situations by relying on channel binding for at least those mechanisms.</p>
<h1 id="rfc.section.2.1"><a href="#rfc.section.2.1">2.1.</a> <a href="#reqresp" id="reqresp">HTTP Request and Response Messages</a></h1>
<p id="rfc.section.2.1.p.1">This section defines a few names for HTTP request and response messages, to be used in the remainder of this specification.</p>
<p id="rfc.section.2.1.p.2">Initial Responses are those HTTP responses that set a status code 401 or 407, and that are sent when the HTTP server decides to initiate an authentication exchange.</p>
<p id="rfc.section.2.1.p.3">Initial Requests are those HTTP requests that a client sends to initiate a fresh SASL authentication.  User-Aware Requests are a variation defined further below, intended for attempts to address public resources under a given user name.</p>
<p id="rfc.section.2.1.p.4">Intermediate Responses are HTTP responses to SASL authentication, with a status code set to 401 or 407.  Intermediate Requests are those HTTP requests that a client sends to continue a SASL authentication after an Intermediate Response.</p>
<p id="rfc.section.2.1.p.5">Final Responses either set a 200 or 403 status code, the first depicting success and the second depicting failure.  Information in a Final 200 Response is provided in an Authentication-Info or Proxy-Authentication-Info header <a href="#RFC7615">[RFC7615]</a> instead of the headers used in Initial Responses and Intermediate Responses <a href="#RFC7235">[RFC7235]</a>.  Note that proper interpretation of the Final 200 Response requires client state indicating that SASL authentication was used, or else the optional fields are not completely reliable information sources; cryptographic markers in the c2c field MAY be used to overcome this in a manner that defies abuse by rogue servers.  The Final 403 Response never contains authentication-related headers.</p>
<p id="rfc.section.2.1.p.6">The following fields, defined in upcoming sections, MUST and MAY be present in HTTP authentication exchanges for SASL:</p>
<pre>
Request or Response   | MUST have fields    | MAY have fields
----------------------+---------------------+--------------------
Unauth Request        |                     | userview,visitor
Initial Response      | mech,s2s,realm      | encalg,enckid,text
Initial Request       | mech,s2s,c2c,realm  | encalg,enckid,c2s,
                      |                     |   userview,visitor
Intermediate Response | mech,c2c,s2c,s2s    | text
Intermediate Request  | mech,c2c,c2s,s2s    | userview,visitor
Final 200 Response    | mech,c2c,name,realm | s2s
Final 403 Response    |                     |
</pre>
<h1 id="rfc.section.2.2"><a href="#rfc.section.2.2">2.2.</a> <a href="#sasldata" id="sasldata">Authentication Field Definitions</a></h1>
<p id="rfc.section.2.2.p.1">Data for SASL is transported in the following fields: </p>

<dl>
  <dt>c2s</dt>
  <dd style="margin-left: 6">holds SASL mechanism-specific data from client to server, usually encrypted during realm crossover.</dd>
  <dt>s2c</dt>
  <dd style="margin-left: 6">holds SASL mechanism-specific data from server to client, usually encrypted during realm crossover.</dd>
  <dt>s2s</dt>
  <dd style="margin-left: 6">holds opaque server data which the client MUST reflect in Intermediate Requests, to implement stateless SASL handling in the server.  This is a requirement for the HTTP Authentication framework [Section 5.1.2 of <a href="#RFC7235">[RFC7235]</a>].</dd>
  <dt>c2c</dt>
  <dd style="margin-left: 6">holds opaque client data which the server MUST reflect in Intermediate Responses and Final 200 Responses.  This can help to also make the client stateless.</dd>
  <dt>encalg</dt>
  <dd style="margin-left: 6">identifies an encryption algorithm to protect the c2s and s2c fields, especially during realm crossover.  When this field is absent, the c2s and s2c fields are not encrypted but literally follow the SASL mechanism exchange.</dd>
  <dt>enckey</dt>
  <dd style="margin-left: 6">is an identity of the encryption key used under encalg.  The fields enckey and encalg MUST always be paired; either both are present, or both are absent.</dd>
</dl>
<p id="rfc.section.2.2.p.2">As in other protocols, it is not safe for all SASL mechanisms to exchange c2s and s2c messages over unprotected transports.  The c2c and s2s fields MUST be protected against tampering by rogue peers, and such protection also protects against tampering by rogue intermediates when using an unprotected transport.  In addition, c2c and s2s fields may also need to be concealed from peers and intermediates.</p>
<p id="rfc.section.2.2.p.3">Whether s2c is supplied in a Final 200 Response depends on the SASL mechanism, which may or may not have additional data to provide in this phase.  Note that SASL requires empty s2c messages to be distinguished from absence thereof.  When the server provides c2s and/or s2s data in a Final 200 Response, then it indicates that the supplied fields MAY provide one-step re-authentication with an empty s2c string, but the server MAY revoke this privilege at any time and for any reason; it would respond with an Initial Response in case of such revocation, but with a quick Final 200 Response if the one-step re-authentication is still acceptable.</p>
<p id="rfc.section.2.2.p.4">The following fields support SASL within the HTTP Authentication Framework: </p>

<dl>
  <dt>userview</dt>
  <dd style="margin-left: 6">selects a user view on the resources accessible over HTTP.  This data selection purpose is unrelated to authentication.  As a general principle, the userview MAY lead to changes in authentication triggers for URI paths, but MUST NOT change authentication triggers for the underlying resources.</dd>
  <dt>realm</dt>
  <dd style="margin-left: 6">optionally names a scope of authorisation under the combination of scheme, server host name and userview.</dd>
  <dt>mech</dt>
  <dd style="margin-left: 6">selects the SASL mechanism to use.  It MUST be reflected from the preceding message, except: In an Initial Response, the field is filled with a space-separated list of SASL mechanism names; In an Initial Request, the client chooses one SASL mechanism name; In a User-Aware Request, the field is fixated to ANONYMOUS.</dd>
  <dt>visitor</dt>
  <dd style="margin-left: 6">is a hint that suggests an unauthenticated client identity.  It cannot be used as a basis of security, other than to point at a SASL backend to use for authentication under realm crossover.</dd>
  <dt>name</dt>
  <dd style="margin-left: 6">is the authorised user@domain.name or domain.name identity.</dd>
  <dt>text</dt>
  <dd style="margin-left: 6">is a user-oriented text explaining what information is needed.</dd>
</dl>
<h1 id="rfc.section.3"><a href="#rfc.section.3">3.</a> <a href="#xover" id="xover">Support for Realm Crossover</a></h1>
<p id="rfc.section.3.p.1">HTTP services tend to define users as part of their own secure realm.  This culminates in competitions over user names in the most popular services.  It also leads to variations in user names across services, difficult to both users and their contacts.  More seriously, it leads to uncertainty about the same-ness of users at different services.  Anyone can claim to be your bank, but there is no basis of trusting such names.</p>
<p id="rfc.section.3.p.2">A more flexible model allows the client to determine their names, and locate them under their own domain.  Provided that services use domain-specific methods for identity assurance, the client can be represented by their complete form, and no concern of same-ness of users names across such services need exist.  As a pleasant side-effect, the competition over user names has become a local matter, to be resolved by the client.</p>
<p id="rfc.section.3.p.3">HTTP SASL supports this model with a number of choices.  First, the format of a user identity is formalised to be a Network Access Identifier <a href="#RFC7542">[RFC7542]</a> of the form</p>
<pre>
nai_clientid ::= utf8-username "@" utf8-realm
</pre>
<p id="rfc.section.3.p.4">Second, there is an option to claim a client identity at all times, without authentication, in any of the forms of a Network Access Identifier,</p>
<pre>
nai_visitor ::= nai
</pre>
<p id="rfc.section.3.p.5">In both cases, the right-hand-side symbols refer to the quoted specification for a NAI.</p>
<p id="rfc.section.3.p.6">The nai_clientid is reported back from SASL to the HTTP service.  When it is provided, it has been validated.  See <a href="#envvars">Appendix A</a> for the mechanism of passing such information from an HTTP server to an application service.</p>
<p id="rfc.section.3.p.7">The nai_visitor is used as a field to the SASL Authorization header, and can be provided at any point.  The form might be sent on its own, as in</p>
<pre>
Authorization: SASL visitor=john@example.com
</pre>
<p id="rfc.section.3.p.8">This identity is also passed from HTTP server to application server, but it comes straight from this header.  This means that it is just a hint at an identity, without any formal status.  Services seem to enjoy such hints, and receiving it in a standardised manner can be beneficial for support in development environments, and it allows more client control.</p>
<p id="rfc.section.3.p.9">It is anticipated that local information is subject to access control rules that determine specific client identities, probably a mixture of individuals and entire domains, who can exercise a variety of rights to the resource offering over HTTP.  This model can be supportive of local users as well as foreign ones.</p>
<p id="rfc.section.3.p.10">The nai_visitor MAY be used as a hint towards a SASL realm to address, especially during the Initial Request generation.  When no nai_visitor is available at that time, local policy dictates what SASL realm to use.  This is important because the SASL realm determines which mechanisms can be offered.</p>
<p id="rfc.section.3.p.11">It could happen that an Intial Response comes back with a different SASL realm in the nai_visitor than assumed during the generation of the Initial Request.  In such cases, the requested SASL realm is approached.  When its offering of mechanisms does not contain the choice made by the client, a new Initial Request SHOULD be generated, to support the client in their change of mind.  There does not seem to be a reason to grant such changes to occur more than once.</p>
<h1 id="rfc.section.3.1"><a href="#rfc.section.3.1">3.1.</a> <a href="#xover.crypt" id="xover.crypt">Encrypting SASL for Realm Crossover</a></h1>
<p id="rfc.section.3.1.p.1">Most SASL methods are unsafe to use over plaintext channels; it is a common and good practice to run it over a secure channel such as TLS.  This is precisely the condition of HTTP SASL with server-based accounts.  But TLS only protects the direct link between a client and a server; during realm crossover the server might effectively be a man-in-the-middle.  This is especially true when a SASL backend in the client's domain is asked to perform the authentication for the HTTP server.</p>
<p id="rfc.section.3.1.p.2">The solution is to encrypt the SASL traffic while in transit.  Since the client and backend authentication service know each other, they can resort to simple mechanisms such as symmetric encryption and integrity checking.  This means that the client and backend need to share a random key and an algorithm.  Random keys can for example be bootstrapped through an ECDHE exchange, or as by-product <a href="#RFC5705">[RFC5705]</a> of a TLS session.</p>
<p id="rfc.section.3.1.p.3">Encryption is determined by an algorithm name, a key identifier and the HTTP server name as it occurs in the Server Name Indication in TLS.  The algorithm name is captured in an enc field and the key identifier in a enckid field to the SASL Authorization header:</p>
<pre>
Authorization: SASL encalg="aes128-cts-hmac-sha256-128" enckid="1783"
</pre>
<p id="rfc.section.3.1.p.4">Key and algorithm naming can be defined locally.  HTTP SASL passes them through verbatim.  SASL end points interpret them, and to improve interoperability the algorithm names SHOULD be the names or numbers of Kerberos encryption types.  This is a practical choice, because most SASL end points have access to suitable code for handling such forms.</p>
<p id="rfc.section.3.1.p.5">Encryption MAY be requested during the Initial Request, which itself is not yet a sensitive message.  When its use is desired by a client, it MUST be included in the Initial Response, and will then be used for the c2s and s2c fields in that message and any following.  Encryption SHOULD be used if an AT character U+0040 is sent as part of a visitor field.</p>
<p id="rfc.section.3.1.p.6">A separate specification will introduce a mapping of SASL into Diameter messages, including support for the enc and key fields.</p>
<h1 id="rfc.section.3.2"><a href="#rfc.section.3.2">3.2.</a> <a href="#userview" id="userview">Viewing Users on HTTP Services</a></h1>
<p id="rfc.section.3.2.p.1">The initial authentication mechanisms for HTTP were Basic and Digest <a href="#RFC2617">[RFC2617]</a> but these are no longer considered secure.  These forms used the username in the URI together with a password, a combination that is now officially deprecated [Section 3.2.1 of <a href="#RFC3986">[RFC3986]</a>].</p>
<p id="rfc.section.3.2.p.2">The use of a user name in a URI has not been deprecated, but has been withdrawn from HTTP because it was not included in the core HTTP specification <a href="#RFC2616">[RFC2616]</a>.  With client identities that support realm crossover, it is possible to add this to SASL Authorization headers, through a new siteuser field, to be used like this:</p>
<pre>
GET / HTTP/1.1
Host: www.example.net
Authorization: SASL userview=snowboarders
</pre>
<p id="rfc.section.3.2.p.3">There is a clear need for users in HTTP URIs, as can be seen from a wild variation of mappings into paths are sub-domains.  The actual use of the username part of the URI is however preferrable, and the URI format defines it in the authority part [Section 3.2 of <a href="#RFC3986">[RFC3986]</a>] which seems to match with the intended uses.  A URI-based user name will probaly still be mapped to a path on a server, but need not be shown in the path in the URI.  Better standardisation of user names is supportive of better integration with tools on both the client and server side.</p>
<p id="rfc.section.3.2.p.4">We emphasise that the userview and client identity are orthogonal concepts, except for the special case where the client is viewing his own resources.  This implies that it can be used with or without authentication.  The userview field indicates the name space of resources beig addressed, while the client identity is involved in access rights.</p>
<p id="rfc.section.3.2.p.5">The reason to integrate the userview with SASL is one of identity control; when the userview changes, one is visiting another part of a HTTP resource space, and it may then be proper to switch to another identity.  This is in line with the scoping of protection spaces [Section 2.2 of <a href="#RFC7235">[RFC7235]</a>] to combinations of URI scheme, URI authority section and a server-defined realm string, where the URI authority section includes the user name in the URI.</p>
<p id="rfc.section.3.2.p.6">Browsers currently show varying behaviours when supplied with a user name.  This is mostly due to the deprecation [Section 3.2.1 of <a href="#RFC3986">[RFC3986]</a>] of userparts with a password embedded.  Unfortunately, this also means that user names in HTTP URIs are sometimes suppressed or warned about.  The userview field is intended to present a constructive alternative, where user names may once more be used to scope the resource name space to that of a user, without saying anything about authentication at all.</p>
<h1 id="rfc.section.4"><a href="#rfc.section.4">4.</a> Security Considerations</h1>
<p id="rfc.section.4.p.1">The SASL exchange may be at risk of tampering when the sequence of HTTP messages is not secured to form one stream.  The termination of such a secure layer MUST also terminate an ongoing SASL handshake.</p>
<p id="rfc.section.4.p.2">SASL EXTERNAL can be a very efficient mechanism to combine with a secure transport layer if that includes authentication.  This may be the case for TLS, especially when client-side authentication is deployed.  Mechanisms other than EXTERNAL should take into account that a relation may exist between identities negotiated in the protective layer and the SASL exchange over HTTP.</p>
<p id="rfc.section.4.p.3">Channel binding is available in some SASL mechanisms.  When used with HTTP SASL over TLS, it binds to the TLS channel, by default using the type tls-unique [Section 3 of <a href="#RFC5929">[RFC5929]</a>].  When doing so, it is vital that either there be no renegotiation of the TLS handshake, or both secure renegotiation <a href="#RFC5746">[RFC5746]</a> and the extended master secret <a href="#RFC7627">[RFC7627]</a> are used.</p>
<h1 id="rfc.section.5"><a href="#rfc.section.5">5.</a> IANA Considerations</h1>
<p id="rfc.section.5.p.1">This specification extends the "Hypertext Transfer Protocol (HTTP) Authentication Scheme Registry" with an "Authentication Scheme Name" SASL, referencing this specification.</p>
<p id="rfc.section.5.p.2">This specification defines an additional entry in the registry "Generic Security Service Application Program Interface (GSSAPI)/Kerberos/Simple Authentication and Security Layer (SASL) Service Names" namely:</p>
<pre>
Service Name: HTTP
Usage:        Web authentication using the SASL framework
Reference:    TBD:this specification
</pre>
<h1 id="rfc.references"><a href="#rfc.references">6.</a> References</h1>
<h1 id="rfc.references.1"><a href="#rfc.references.1">6.1.</a> Normative References</h1>
<table>
  <tbody>
    <tr>
      <td class="reference">
        <b id="RFC2616">[RFC2616]</b>
      </td>
      <td class="top"><a>Fielding, R.</a>, <a>Gettys, J.</a>, <a>Mogul, J.</a>, <a>Frystyk, H.</a>, <a>Masinter, L.</a>, <a>Leach, P.</a> and <a>T. Berners-Lee</a>, "<a href="http://tools.ietf.org/html/rfc2616">Hypertext Transfer Protocol -- HTTP/1.1</a>", RFC 2616, DOI 10.17487/RFC2616, June 1999.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC3986">[RFC3986]</b>
      </td>
      <td class="top"><a>Berners-Lee, T.</a>, <a>Fielding, R.</a> and <a>L. Masinter</a>, "<a href="http://tools.ietf.org/html/rfc3986">Uniform Resource Identifier (URI): Generic Syntax</a>", STD 66, RFC 3986, DOI 10.17487/RFC3986, January 2005.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC4120">[RFC4120]</b>
      </td>
      <td class="top"><a>Neuman, C.</a>, <a>Yu, T.</a>, <a>Hartman, S.</a> and <a>K. Raeburn</a>, "<a href="http://tools.ietf.org/html/rfc4120">The Kerberos Network Authentication Service (V5)</a>", RFC 4120, DOI 10.17487/RFC4120, July 2005.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC4559">[RFC4559]</b>
      </td>
      <td class="top"><a>Jaganathan, K.</a>, <a>Zhu, L.</a> and <a>J. Brezak</a>, "<a href="http://tools.ietf.org/html/rfc4559">SPNEGO-based Kerberos and NTLM HTTP Authentication in Microsoft Windows</a>", RFC 4559, DOI 10.17487/RFC4559, June 2006.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC4422">[RFC4422]</b>
      </td>
      <td class="top"><a>Melnikov, A.</a> and <a>K. Zeilenga</a>, "<a href="http://tools.ietf.org/html/rfc4422">Simple Authentication and Security Layer (SASL)</a>", RFC 4422, DOI 10.17487/RFC4422, June 2006.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC5056">[RFC5056]</b>
      </td>
      <td class="top"><a>Williams, N.</a>, "<a href="http://tools.ietf.org/html/rfc5056">On the Use of Channel Bindings to Secure Channels</a>", RFC 5056, DOI 10.17487/RFC5056, November 2007.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC5554">[RFC5554]</b>
      </td>
      <td class="top"><a>Williams, N.</a>, "<a href="http://tools.ietf.org/html/rfc5554">Clarifications and Extensions to the Generic Security Service Application Program Interface (GSS-API) for the Use of Channel Bindings</a>", RFC 5554, DOI 10.17487/RFC5554, May 2009.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC5746">[RFC5746]</b>
      </td>
      <td class="top"><a>Rescorla, E.</a>, <a>Ray, M.</a>, <a>Dispensa, S.</a> and <a>N. Oskov</a>, "<a href="http://tools.ietf.org/html/rfc5746">Transport Layer Security (TLS) Renegotiation Indication Extension</a>", RFC 5746, DOI 10.17487/RFC5746, February 2010.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC5801">[RFC5801]</b>
      </td>
      <td class="top"><a>Josefsson, S.</a> and <a>N. Williams</a>, "<a href="http://tools.ietf.org/html/rfc5801">Using Generic Security Service Application Program Interface (GSS-API) Mechanisms in Simple Authentication and Security Layer (SASL): The GS2 Mechanism Family</a>", RFC 5801, DOI 10.17487/RFC5801, July 2010.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC5929">[RFC5929]</b>
      </td>
      <td class="top"><a>Altman, J.</a>, <a>Williams, N.</a> and <a>L. Zhu</a>, "<a href="http://tools.ietf.org/html/rfc5929">Channel Bindings for TLS</a>", RFC 5929, DOI 10.17487/RFC5929, July 2010.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC6595">[RFC6595]</b>
      </td>
      <td class="top"><a>Wierenga, K.</a>, <a>Lear, E.</a> and <a>S. Josefsson</a>, "<a href="http://tools.ietf.org/html/rfc6595">A Simple Authentication and Security Layer (SASL) and GSS-API Mechanism for the Security Assertion Markup Language (SAML)</a>", RFC 6595, DOI 10.17487/RFC6595, April 2012.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC7235">[RFC7235]</b>
      </td>
      <td class="top"><a>Fielding, R.</a> and <a>J. Reschke</a>, "<a href="http://tools.ietf.org/html/rfc7235">Hypertext Transfer Protocol (HTTP/1.1): Authentication</a>", RFC 7235, DOI 10.17487/RFC7235, June 2014.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC7542">[RFC7542]</b>
      </td>
      <td class="top"><a>DeKok, A.</a>, "<a href="http://tools.ietf.org/html/rfc7542">The Network Access Identifier</a>", RFC 7542, DOI 10.17487/RFC7542, May 2015.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC7615">[RFC7615]</b>
      </td>
      <td class="top"><a>Reschke, J.</a>, "<a href="http://tools.ietf.org/html/rfc7615">HTTP Authentication-Info and Proxy-Authentication-Info Response Header Fields</a>", RFC 7615, DOI 10.17487/RFC7615, September 2015.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC7627">[RFC7627]</b>
      </td>
      <td class="top"><a>Bhargavan, K.</a>, <a>Delignat-Lavaud, A.</a>, <a>Pironti, A.</a>, <a>Langley, A.</a> and <a>M. Ray</a>, "<a href="http://tools.ietf.org/html/rfc7627">Transport Layer Security (TLS) Session Hash and Extended Master Secret Extension</a>", RFC 7627, DOI 10.17487/RFC7627, September 2015.</td>
    </tr>
  </tbody>
</table>
<h1 id="rfc.references.2"><a href="#rfc.references.2">6.2.</a> Informative References</h1>
<table>
  <tbody>
    <tr>
      <td class="reference">
        <b id="RFC2617">[RFC2617]</b>
      </td>
      <td class="top"><a>Franks, J.</a>, <a>Hallam-Baker, P.</a>, <a>Hostetler, J.</a>, <a>Lawrence, S.</a>, <a>Leach, P.</a>, <a>Luotonen, A.</a> and <a>L. Stewart</a>, "<a href="http://tools.ietf.org/html/rfc2617">HTTP Authentication: Basic and Digest Access Authentication</a>", RFC 2617, DOI 10.17487/RFC2617, June 1999.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC4505">[RFC4505]</b>
      </td>
      <td class="top"><a>Zeilenga, K.</a>, "<a href="http://tools.ietf.org/html/rfc4505">Anonymous Simple Authentication and Security Layer (SASL) Mechanism</a>", RFC 4505, DOI 10.17487/RFC4505, June 2006.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC5705">[RFC5705]</b>
      </td>
      <td class="top"><a>Rescorla, E.</a>, "<a href="http://tools.ietf.org/html/rfc5705">Keying Material Exporters for Transport Layer Security (TLS)</a>", RFC 5705, DOI 10.17487/RFC5705, March 2010.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC5785">[RFC5785]</b>
      </td>
      <td class="top"><a>Nottingham, M.</a> and <a>E. Hammer-Lahav</a>, "<a href="http://tools.ietf.org/html/rfc5785">Defining Well-Known Uniform Resource Identifiers (URIs)</a>", RFC 5785, DOI 10.17487/RFC5785, April 2010.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC5802">[RFC5802]</b>
      </td>
      <td class="top"><a>Newman, C.</a>, <a>Menon-Sen, A.</a>, <a>Melnikov, A.</a> and <a>N. Williams</a>, "<a href="http://tools.ietf.org/html/rfc5802">Salted Challenge Response Authentication Mechanism (SCRAM) SASL and GSS-API Mechanisms</a>", RFC 5802, DOI 10.17487/RFC5802, July 2010.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC7804">[RFC7804]</b>
      </td>
      <td class="top"><a>Melnikov, A.</a>, "<a href="http://tools.ietf.org/html/rfc7804">Salted Challenge Response HTTP Authentication Mechanism</a>", RFC 7804, DOI 10.17487/RFC7804, March 2016.</td>
    </tr>
  </tbody>
</table>
<h1 id="rfc.appendix.A"><a href="#rfc.appendix.A">Appendix A.</a> <a href="#envvars" id="envvars">HTTP Server Environment Variables</a></h1>
<p id="rfc.section.A.p.1">We define a number of variables that SHOULD be passed from an HTTP SASL stack to applications run on top of it.  The intention of defining these is to obtain maximum interoperability between these layers of software.</p>
<p id="rfc.section.A.p.2">A common practice is to set environment variables with a given name to values that may be meaningful to applications.  Those applications should be mindful about the possible meaning of absent variables.</p>
<p id="rfc.section.A.p.3">The following variables MAY be available in both the SASL authenticated and unauthenticated state: </p>

<dl>
  <dt>SASL_SITEVIEW</dt>
  <dd style="margin-left: 6">refers to the user name in the URI and SHOULD NOT be used with a password.  It refines the view on resources held by the web server, usually from a general site to one that is user-specific.  The URI user is considered local to the web server (and, as a result of that, often its domain or security realm).  This variable is only set when it is provided through the siteview field in the SASL exchange.</dd>
  <dt>SASL_VISITOR</dt>
  <dd style="margin-left: 6">refers to self-identification of the client independent of authentication.  Its general form is that of an email address, but its local part MAY be empty.  This variable may be used to determine the domain against which the client intends to authenticate and, from that, the SASL mechanisms that can be offered.</dd>
</dl>
<p id="rfc.section.A.p.4">The following variables MUST NOT be available until SASL authentication is successful; it would be available when the server could send a 200 OK response: </p>

<dl>
  <dt>SASL_SECURE</dt>
  <dd style="margin-left: 6">is only "yes" (without the quotes) when a client is authenticated to the current resource.  It never has another value; it is simply undefined when not secured by SASL.</dd>
  <dt>SASL_REALM</dt>
  <dd style="margin-left: 6">is the realm for which the secure exchange succeeded.  A realm is not always used, because sites only need it when there are more than one in the same name space.  When undefined in the SASL flow, this variable will not be set.</dd>
  <dt>SASL_CLIENTID</dt>
  <dd style="margin-left: 6">is the identity as confirmed through SASL authentication.  Its content is formatted like an email address, and includes a domain name.  That domain need not be related to the web server; it is possible for a web server to welcome foreign clients.</dd>
  <dt>SASL_MECH</dt>
  <dd style="margin-left: 6">indicates the mechanism used, and is one of the standardised SASL mechanism names.  It may be used to detect the level of security.</dd>
  <dt>SASL_S2S</dt>
  <dd style="margin-left: 6">holds the accepted s2s field, and could be used as a random session identifier.  It would normally be encrypted information.</dd>
  <dt>SASL_S2S_</dt>
  <dd style="margin-left: 6">is a prefix for extra information that the server may extract from the s2s field in the HTTP SASL protocol flow.  This depends on the authentication stack used in the web server.</dd>
</dl>
<h1 id="rfc.appendix.B"><a href="#rfc.appendix.B">Appendix B.</a> <a href="#ack" id="ack">Acknowledgements</a></h1>
<p id="rfc.section.B.p.1">Thanks to Henri Manson for making the first implementation of this specification and for feedback on the header formats.</p>
<h1 id="rfc.authors">
  <a href="#rfc.authors">Author's Address</a>
</h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Rick van Rein</span> 
	  <span class="n hidden">
		<span class="family-name">Van Rein</span>
	  </span>
	</span>
	<span class="org vcardline">ARPA2.net</span>
	<span class="adr">
	  <span class="vcardline">Haarlebrink 5</span>

	  <span class="vcardline">
		<span class="locality">Enschede</span>,  
		<span class="region">Overijssel</span> 
		<span class="code">7544 WP</span>
	  </span>
	  <span class="country-name vcardline">The Netherlands</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:rick@openfortress.nl">rick@openfortress.nl</a></span>

  </address>
</div>

</body>
</html>
